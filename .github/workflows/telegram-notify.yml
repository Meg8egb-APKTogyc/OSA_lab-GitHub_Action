name: Telegram Notifications

on:
  workflow_run:
    workflows: ["Main CI/CD Pipeline", "Build and Package"]
    types:
      - completed

jobs:
  notify:
    name: Send Telegram Notification
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion != 'skipped' }}
    
    steps:
    - name: Send success notification
      if: github.event.workflow_run.conclusion == 'success'
      uses: appleboy/telegram-action@master
      env:
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
      with:
        to: ${{ env.TELEGRAM_CHAT_ID }}
        token: ${{ env.TELEGRAM_TOKEN }}
        message: |
          ‚úÖ *${{ github.event.workflow_run.name }} - SUCCESS*
          
          üìÅ Repository: ${{ github.repository }}
          üåø Branch: ${{ github.event.workflow_run.head_branch }}
          üîó Run: ${{ github.event.workflow_run.html_url }}
          ‚è±Ô∏è Duration: ${{ github.event.workflow_run.run_duration }}s
          
          üéâ All checks passed successfully!
        format: markdown
        
    - name: Send failure notification
      if: github.event.workflow_run.conclusion == 'failure'
      uses: appleboy/telegram-action@master
      env:
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
      with:
        to: ${{ env.TELEGRAM_CHAT_ID }}
        token: ${{ env.TELEGRAM_TOKEN }}
        message: |
          ‚ùå *${{ github.event.workflow_run.name }} - FAILED*
          
          üìÅ Repository: ${{ github.repository }}
          üåø Branch: ${{ github.event.workflow_run.head_branch }}
          üîó Run: ${{ github.event.workflow_run.html_url }}
          
          ‚ö†Ô∏è Some checks failed. Please review the workflow run.
        format: markdown
