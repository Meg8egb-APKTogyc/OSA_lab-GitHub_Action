name: Telegram Notifications

on:
  workflow_run:
    workflows:
      - "Main CI/CD Pipeline"
      - "Java CI with PostgreSQL"
      - "Build and Package"
      - "Scheduled Security Checks"
    types:
      - completed
    branches: [master]

jobs:
  notify:
    name: Send Telegram Notification
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion != 'skipped' }}
    
    steps:
    - name: Extract workflow info
      id: workflow-info
      run: |
        echo "workflow_name=${{ github.event.workflow_run.name }}" >> $GITHUB_OUTPUT
        echo "workflow_url=${{ github.event.workflow_run.html_url }}" >> $GITHUB_OUTPUT
        echo "branch=${{ github.event.workflow_run.head_branch }}" >> $GITHUB_OUTPUT
        echo "status=${{ github.event.workflow_run.conclusion }}" >> $GITHUB_OUTPUT
        echo "actor=${{ github.event.workflow_run.actor.login }}" >> $GITHUB_OUTPUT
        
    - name: Send Telegram message
      uses: appleboy/telegram-action@master
      with:
        to: ${{ secrets.TELEGRAM_CHAT_ID }}
        token: ${{ secrets.TELEGRAM_TOKEN }}
        message: |
          ${{ steps.workflow-info.outputs.status == 'success' && '‚úÖ' || '‚ùå' }} *${{ steps.workflow-info.outputs.workflow_name }} - ${{ steps.workflow-info.outputs.status }}*
          
          üìÅ *Repository:* ${{ github.repository }}
          üë§ *Triggered by:* ${{ steps.workflow-info.outputs.actor }}
          üåø *Branch:* ${{ steps.workflow-info.outputs.branch }}
          üîó *View run:* ${{ steps.workflow-info.outputs.workflow_url }}
          
          ${{ steps.workflow-info.outputs.status == 'success' && 'üéâ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!' || '‚ö†Ô∏è –ï—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã, —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞!' }}
          
          _–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ GitHub Actions_
        format: markdown
        disable_web_page_preview: true
